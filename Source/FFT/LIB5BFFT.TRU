1000 EXTERNAL     !LIB5BFFT.TRU101010201030 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1040 SUB HJW( CONCORFLAG, CENTFREQ, N, XRE(), XIM(), X2RE(), X2IM(), FFTRE(), FFTIM(), FFT2RE(), FFT2IM(), IFFTRE(), IFFTIM(), TEMPRE(), TEMPIM(), TEMP2RE(), TEMP2IM(), XFLAG, X2FLAG, REALFLAGX, FFTFLAG, FFT2FLAG, SYMMFLAG, IFFTFLAG, REALFLAGIFFT, CONVFLAG, FORM$, TYPE$, T, MODE$, MMENU, HJWFLAG, CTOP(), CBOT(), ROM(), COSMULT(), SINMULT(), FIRSTTIME, FREEMEM, ORG$, ORG2$, LOOPROUND, KLEEN$, TAXIS, FAXIS, FILESTR$ )10501060 LET FIRSTTIME = 110701080   DO1090     LET SKIP1 = 01100     LET SKIP2 = 01110                            !CREATE, CHANGE, DISPLAY, LOAD, MAIN MENU, QUIT1120     CALL PAINTSTATUS(CONCORFLAG, CENTFREQ, N, MODE$, TYPE$, T, XFLAG, X2FLAG, REALFLAGX, FFTFLAG, FFT2FLAG, SYMMFLAG, IFFTFLAG, REALFLAGIFFT, CONVFLAG, KLEEN$, FREEMEM, HJWFLAG, TAXIS, FAXIS, FILESTR$ )1130     CALL BOX38( Z1$ )11401150     IF Z1$ = "Q" OR Z1$ = "M" THEN1160       IF Z1$ = "M" THEN1170         IF HJWFLAG = 0 AND CREATED = 1 THEN1180           CALL MACSYSBEEP(1)11901200           CALL BOX112( RVO$ )12101220           IF RVO$ = "H" THEN1230             LET MMENU = 01240             LET CHANGEPARAMS = 01250           ELSE IF RVO$ = "M" THEN1260             LET MMENU = 11270           END IF1280         ELSE1290           LET MMENU = 11300         END IF1310       ELSE IF Z1$ = "Q" THEN1320         LET LOOPROUND = 11330       END IF1340     ELSE1350       LET FIRSTTIME = 01360       IF Z1$ = "A" THEN13701380         CALL CREATEHJW13901400       ELSE IF Z1$ = "B" THEN14101420         CALL CHANGEHJW14301440       ELSE IF Z1$ = "C" THEN    !DISPLAY COEFFICIENTS14501460         CALL SHOWHJW14701480       ELSE IF Z1$ = "D" THEN14901500         CALL LOADHJW15101520       END IF1530     END IF1540   LOOP UNTIL MMENU = 1 OR LOOPROUND = 115501560   CLEAR15701580 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1590 SUB CREATEHJW16001610   LET BACKOUT = 01620   LET SKIP2 = 01630   LET HJWFLAG = 01640   CALL CLEARFFT2( FFT2RE(), FFT2IM(), FFT2FLAG )16501660   CLEAR1670   PRINT TAB(1,1);"THE FREQUENCY RESPONSE IS A QUOTIENT OF TWO POLYNOMIALS IN  jw"16801690   PRINT TAB(3,1);"          A0 + A1(jw) + A2(jw)^2 + ... + Ar(jw)^R  <------ "1700   PRINT TAB(4,1);"  H(jw) = ---------------------------------------"1710   PRINT TAB(5,1);"          B0 + B1(jw) + B2(jw)^2 + ... + Bs(jw)^S  <------ "17201730   PRINT TAB(7,1);"THE DEGREE OF THE NUMERATOR IS  R  AND OF THE DENOMINATOR  S"17401750   LET MESSAGE$ = "WHAT IS THE DEGREE OF THE NUMERATOR ?"1760   LET MESSAGE$ = MESSAGE$ & "|" & "(0 <= R <= 16)"1770   DO17801790     CALL INPUTVALL( MESSAGE$, FDG, SHOWFLAG, FLAG )18001810     IF FLAG = 1 THEN1820       LET SKIP2 = 11830       CLEAR1840       EXIT DO1850     ELSE IF FLAG = 0 THEN1860       LET DEGTOP = FDG1870       IF DEGTOP <> INT(DEGTOP) OR DEGTOP < 0 OR DEGTOP > 16 THEN CALL MACSYSBEEP(1)1880     END IF1890   LOOP UNTIL FLAG = 1 OR (DEGTOP = INT(DEGTOP) AND DEGTOP >= 0 AND DEGTOP <= 16)19001910   IF SKIP2 = 0 THEN1920     LET CTOP(-1) = DEGTOP1930     LET MESSAGE$ = "WHAT IS THE DEGREE OF THE DENOMINATOR ?"1940     LET MESSAGE$ = MESSAGE$ & "|" & "(" & STR$(DEGTOP) & " <= S <= 16) ? "1950     DO19601970       CALL INPUTVALL( MESSAGE$, FDG, SHOWFLAG, FLAG )19801990       IF FLAG = 1 THEN2000         LET SKIP2 = 12010         LET CBOT(-1) = -12020         CLEAR2030         EXIT DO2040       ELSE IF FLAG = 0 THEN2050         LET DEGBOT = FDG2060         IF (DEGBOT <> INT(DEGBOT) OR DEGBOT < DEGTOP OR DEGBOT > 16) THEN CALL MACSYSBEEP(1)2070       END IF2080     LOOP UNTIL FLAG = 1 OR (DEGBOT = INT(DEGBOT) AND DEGBOT >= DEGTOP AND DEGBOT <= 16)2090   END IF21002110   IF SKIP2 = 0 THEN2120     LET CBOT(-1) = DEGBOT2130     CLEAR21402150     FOR I = 0 TO CTOP(-1)2160       LET MESSAGE$ = ""2170       LET MESSAGE$ = "NOW CREATING THE NUMERATOR POLYNOMIAL OF H(jw)..."2180       LET MESSAGE$ = MESSAGE$ & "|" & "|" & "COEFF OF (jw)^" & STR$(I) & " : " & "A(" & STR$(I) & ") = "2190       LET SHOWFLAG = 022002210       CALL INPUTVALL( MESSAGE$, FDG, SHOWFLAG, FLAG )22202230       IF FLAG = 1 THEN2240         MAT CTOP = 02250         LET BACKOUT = 12260         EXIT FOR2270       ELSE IF FLAG = 0 THEN2280         LET CTOP(I) = FDG2290       END IF2300     NEXT I23102320     IF BACKOUT = 0 THEN2330       CLEAR2340       FOR I = 0 TO CBOT(-1)2350         LET MESSAGE$ = ""2360         LET MESSAGE$ = "NOW CREATING THE DENOMINATOR POLYNOMIAL OF H(jw)..."2370         LET MESSAGE$ = MESSAGE$ & "||" & "(ONLY NON-NEGATIVE COEFFICIENTS ACCEPTED)"2380         LET MESSAGE$ = MESSAGE$ & "|" & "|" & "COEFF OF (jw)^" & STR$(I) & " : " & "B(" & STR$(I) & ") = "2390         LET SHOWFLAG = 024002410         DO2420           DO2430              LET LOOPNOW = 024402450              CALL INPUTVALL( MESSAGE$, FDG, SHOWFLAG, FLAG )24602470             IF FLAG = 1 THEN2480               MAT CBOT = 02490               LET CBOT(-1) = -12500               LET BACKOUT = 12510               EXIT DO2520             ELSE IF FLAG = 0 THEN2530               LET VALUE = FDG2540               IF I = 0 AND VALUE = 0 THEN25502560                 CALL BOX114B25702580                 LET LOOPNOW = 12590               ELSE IF I = CBOT(-1) AND VALUE = 0 THEN26002610                 CALL BOX114C(CBOT())26202630                 LET LOOPNOW = 12640               ELSE IF VALUE < 0 THEN2650                 CALL MACSYSBEEP(1)2660               END IF2670             END IF2680           LOOP WHILE LOOPNOW = 12690         LOOP UNTIL VALUE >= 027002710         IF BACKOUT = 1 THEN2720           CLEAR2730           EXIT FOR2740         ELSE2750           LET CBOT(I) = VALUE2760         END IF2770       NEXT I27802790       IF BACKOUT = 0 THEN2800         LET CREATED = 12810         CALL SHOWHJW2820       END IF2830     END IF2840   END IF28502860 END SUB !CREATEHJW2870 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!288028902900 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!2910 SUB SHOWHJW29202930   IF CTOP(-1) = -1 OR CBOT(-1) = -1 THEN2940     CALL MACSYSBEEP(1)29502960     CALL BOX11129702980   ELSE29903000     IF MAX(CTOP(-1),CBOT(-1)) >= 10 THEN3010       CLEAR3020       PRINT TAB(2,35);"R =";CTOP(-1)3030       PRINT TAB(2,60);"S =";CBOT(-1)3040       PRINT TAB(3,9);"COEFF OF"3050       PRINT TAB(3,33);"NUMERATOR"3060       PRINT TAB(3,57);"DENOMINATOR"3070       FOR I = 0 TO MAX(CTOP(-1),CBOT(-1))3080         LET I$ = STR$(I)3090         LET STR1$ = "(jw)^" & I$3100         PRINT TAB(5+I,10);STR1$3110       NEXT I3120       FOR I = 0 TO CTOP(-1)3130         LET I$ = STR$(I)3140         LET STR1$ = "A(" & I$ & ") ="3150         PRINT TAB(5+I,33) ; STR1$ ; CTOP(I)3160       NEXT I3170       FOR I = 0 TO CBOT(-1)3180         LET I$ = STR$(I)3190         LET STR1$ = "B(" & I$ & ") ="3200         PRINT TAB(5+I,58) ; STR1$ ; CBOT(I)3210       NEXT I32203230       DO3240         LET FRAZ$ = "| CHANGE VALUES ... C | LOAD H(jw) ... L | QUIT ... Q | ?  "3250   PRINT "WAITING FOR 5-BUTT0N"3260   PAUSE .53270   EXIT DO3280         IF ASD$ <> "C" AND ASD$ <> "L" AND ASD$ <> "Q" THEN CALL MACSYSBEEP(1)3290       LOOP UNTIL ASD$ = "C" OR ASD$ = "L" OR ASD$ = "Q"33003310     ELSE33203330       CALL BOXCOEFFS( CTOP(), CBOT(), ASD$ )33403350     END IF33603370     IF ASD$ = "C" THEN33803390       CALL CHANGEHJW34003410     ELSE IF ASD$ = "L" THEN34203430       CALL LOADHJW34403450     ELSE IF ASD$ = "Q" THEN3460       CLEAR3470     END IF3480   END IF34903500 END SUB !SHOWHJW3510 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!3520353035403550 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!3560 SUB CHANGEHJW35703580   IF CBOT(-1) = -1 OR CTOP(-1) = -1 THEN3590     CALL MACSYSBEEP(1)36003610     CALL BOX111  !H(jw) HAS NOT YET BEEN CREATED... PLEASE CREATE IT36203630   ELSE36403650     CALL BOX113( DUMMY1$ )  !CHANGE NUMERATOR OR DENOMINATOR ?36603670     IF DUMMY1$ = "Q" THEN3680       LET SKIP1 = 13690       LET MMENU = 03700       CLEAR3710     ELSE IF DUMMY1$ = "N" OR DUMMY1$ = "D" THEN3720       LET HJWFLAG = 037303740       CALL CLEARFFT2( FFT2RE(), FFT2IM(), FFT2FLAG )37503760       DO3770         IF DUMMY1$ = "N" THEN3780           FOR I = 0 TO CTOP(-1)3790             LET STRA$ = "A(" & STR$(I) & ")"38003810             CALL CTOPP( STRA$, CTOP(), I, DUMMY2$ )38203830             IF DUMMY2$ = "C" THEN3840               LET MESSAGE$ = "THE CURRENT VALUE IS SHOWN BELOW..."3850               LET MESSAGE$ = MESSAGE$ & "|" & "PLEASE ENTER REQUIRED VALUE"3860               LET FDG = CTOP(I)3870               LET SHOWFLAG = 138803890               CALL INPUTVALL( MESSAGE$, FDG, SHOWFLAG, FLAG )39003910               IF FLAG = 1 THEN3920                 EXIT DO3930               ELSE IF FLAG = 0 THEN3940                 LET CTOP(I) = FDG3950                 LET MESSAGE$ = "O.K. NEW VALUE IS " & STR$(CTOP(I))39603970                 CALL BOX40D( MESSAGE$ )   ! GO39803990               END IF40004010             ELSE IF DUMMY2$ = "G" THEN4020               PRINT40304040             ELSE IF DUMMY2$ = "S" THEN4050               LET DUMMY1$ = "D"4060               LET SKIP1 = 04070               EXIT FOR40804090             ELSE IF DUMMY2$ = "Q" THEN4100               LET SKIP1 = 14110               LET MMENU = 04120               CLEAR4130               EXIT FOR4140             END IF4150           NEXT I41604170         ELSE IF DUMMY1$ = "D" THEN4180           FOR I = 0 TO CBOT(-1)4190             DO4200               LET FLAG = 04210               LET STRB$ = "B(" & STR$(I) & ")"42204230               CALL CBOTT( STRB$, CBOT(), I, DUMMY2$ )42404250               IF DUMMY2$ = "C" THEN42604270                 DO4280                   LET MESSAGE$ = "THE CURRENT VALUE IS SHOWN BELOW..."4290                   LET MESSAGE$ = MESSAGE$ & "||" & "PLEASE ENTER REQUIRED VALUE"4300                   IF I <> 0 AND I <> CBOT(-1) THEN4310                     LET MESSAGE$ = MESSAGE$ & "|" & "  (A NON-NEGATIVE NUMBER)"4320                   ELSE IF I = 0 OR I = CBOT(-1) THEN4330                     LET MESSAGE$ = MESSAGE$ & "|" & "  (A POSITIVE NUMBER)"4340                   END IF4350                   LET FDG = CBOT(I)4360                   LET SHOWFLAG = 143704380                   CALL INPUTVALL( MESSAGE$, FDG, SHOWFLAG, FLAG )43904400                   IF FLAG = 1 THEN4410                     EXIT DO4420                   ELSE IF FLAG = 0 THEN4430                     LET VALUE = FDG4440                     LET TES = 044504460                     IF I <> 0 AND I <> CBOT(-1) THEN4470                       IF VALUE >= 0 THEN LET TES = 14480                     ELSE IF I = 0 OR I = CBOT(-1) THEN4490                       IF VALUE > 0 THEN LET TES = 14500                     END IF4510                     IF TES = 1 THEN4520                       LET CBOT(I) = VALUE4530                       LET MESSAGE$ = "O.K. NEW VALUE IS " & STR$(CBOT(I))45404550                       CALL BOX40D( MESSAGE$ )  ! GO45604570                     ELSE IF TES = 0 THEN4580                       CALL MACSYSBEEP(1)4590                     END IF4600                   END IF4610                 LOOP UNTIL TES = 146204630               ELSE IF DUMMY2$ = "G" THEN4640                PRINT46504660               ELSE IF DUMMY2$ = "S" THEN4670                 LET DUMMY1$ = "N"4680                 LET SKIP1 = 04690                 EXIT FOR47004710               ELSE IF DUMMY2$ = "Q" THEN4720                 LET SKIP1 = 14730                 LET MMENU = 04740                 CLEAR4750                 EXIT FOR4760               END IF47704780             LOOP WHILE FLAG = 14790           NEXT I4800         END IF4810       LOOP UNTIL SKIP1 = 14820     END IF4830     LET SHOWFLAG = 048404850     CALL SHOWHJW48604870   END IF48804890 END SUB !CHANGEHJW4900 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!4910492049304940 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!4950 SUB LOADHJW49604970   LET BACKOUT = 04980   LET SETZERO = 049905000   IF CTOP(-1) = -1 OR CBOT(-1) = -1 THEN5010     CALL MACSYSBEEP(1)50205030     CALL BOX11150405050   ELSE50605070     PRINT5080     LET TESTFLAG = 050905100     FOR I = 0 TO CBOT(-1)5110       IF CBOT(I) <> 0 THEN5120         LET TESTFLAG = 15130       END IF5140     NEXT I51505160     IF 0 = 0 THEN    !ALL O.K.  NOW PROCEEDING TO LOAD  H(jw)51705180       LET HJWFLAG = 051905200       CALL CLEARFFT2( FFT2RE(), FFT2IM(), FFT2FLAG )52105220       IF CBOT(-1) = CTOP(-1) THEN    !EXTRACTING THE DIRAC DELTA5230         LET VAL = CTOP(-1)5240         LET DIRAC = CTOP(VAL)/CBOT(VAL)5250         FOR K = 0 TO VAL5260           LET CTOP(K) = CTOP(K) - DIRAC*CBOT(K)5270         NEXT K5280       END IF52905300       LET OMEGAs = 2*PI/T5310       LET P2 = PI/253205330       DO5340         LET NEWALPHA = 05350         LET SETZER0  = 053605370         CALL BOX115( BACKOUT, A )53805390         IF BACKOUT = 1 THEN EXIT DO54005410         IF A >= 64 THEN5420           LET CC = INT((8 - LOG2(A))/2)5430           LET DD = 2^CC5440           LET EE = INT(DD*A)5450         END IF54605470         CLEAR5480         PRINT5490         PRINT "ALIASING LEVEL IS ---> ALPHA = ";A;":  PRESS SPACE BAR TO TAKE CONTROL"5500         PRINT5510         LET NUMB = INT(N/32)5520         IF NUMB = 0 THEN LET NUMB = 15530         LET SETZERO = 05540         LET J = 05550         DO5560           LET FFT2RE(J) = 05570           LET FFT2IM(J) = 05580           LET V = J - A*N     !A IS ALIAS LEVEL5590           IF MOD(J,16) = 0 THEN5600             PRINT "|"; NUMB; "|";5610             LET NUMB = NUMB - 15620           END IF5630           DO5640             IF A >= 64 THEN5650               LET COUNT1 = COUNT1 + 15660               IF MOD(COUNT1,EE) = 0 THEN5670                 PRINT ".";5680                 LET COUNT2 = COUNT2 + 15690                 IF MOD(COUNT2,1000) = 0 THEN5700                   PRINT5710                   PRINT5720                   PRINT "ALIASING LEVEL IS ---> ALPHA = ";A;":  PRESS SPACE BAR TO TAKE CONTROL"5730                   PRINT5740                 END IF5750               END IF5760             END IF57705780             IF KEY INPUT THEN5790               GET KEY INKEY5800               IF INKEY = 32 THEN58105820                 CALL BOX116( WCT$ )58305840                 CLEAR5850                 IF WCT$ = "R" THEN5860                   PRINT5870                   PRINT "ALIASING LEVEL IS ---> ALPHA = ";A;":  PRESS SPACE BAR TO TAKE CONTROL"5880                   PRINT5890                 ELSE IF WCT$ = "N" THEN5900                   LET SETZERO = 15910                   LET NEWALPHA = 15920                   MAT FFT2RE = 05930                   MAT FFT2IM = 05940                 ELSE IF WCT$ = "Q" THEN5950                   LET SETZERO = 15960                 END IF5970               END IF5980             END IF59906000             IF SETZERO = 0 THEN6010               LET RR = V*OMEGAs6020               FOR K = 0 TO MAX(CTOP(-1),CBOT(-1))6030                 LET ROM(K) = RR^K6040                 LET COSMULT(K) = COS(K*P2)    !P2 IS ¹/26050                 LET SINMULT(K) = SIN(K*P2)6060               NEXT K60706080               LET TOPRE = 06090               LET TOPIM = 06100               LET BOTRE = 06110               LET BOTIM = 061206130               FOR K = 0 TO CTOP(-1)6140                 LET AA = CTOP(K)*ROM(K)6150                 LET TOPRE = TOPRE + AA*COSMULT(K)6160                 LET TOPIM = TOPIM + AA*SINMULT(K)6170               NEXT K6180               FOR K = 0 TO CBOT(-1)6190                 LET AA = CBOT(K)*ROM(K)6200                 LET BOTRE = BOTRE + AA*COSMULT(K)6210                 LET BOTIM = BOTIM + AA*SINMULT(K)6220               NEXT K62306240               LET DENOM = BOTRE^2 + BOTIM^26250               LET FFT2RE(J) = FFT2RE(J) + (TOPRE*BOTRE + TOPIM*BOTIM)/DENOM6260               LET FFT2IM(J) = FFT2IM(J) + (TOPIM*BOTRE - TOPRE*BOTIM)/DENOM6270               LET V = V + N6280             END IF6290           LOOP UNTIL V > J + A*N OR SETZERO = 163006310           LET J = J + 16320         LOOP UNTIL J > INT(N/2) OR SETZERO = 16330         PRINT !TO RELEASE THE ";"6340       LOOP WHILE NEWALPHA = 163506360       IF BACKOUT = 0 THEN6370         IF SETZERO = 0 THEN6380           LET SCALE = 16390           IF MODE$ = "SAMP" AND TYPE$ = "PER" THEN6400             LET SCALE = N6410           ELSE IF MODE$ = "SAMP" AND TYPE$ = "PUL" THEN6420             LET SCALE = N/T6430           END IF6440           LET FFT2IM(0) = 06450           IF N/2 = INT(N/2) THEN6460             LET FFT2IM(N/2) = 06470           END IF6480           FOR K = 0 TO INT(N/2)6490             LET FFT2RE(K)     = SCALE*(FFT2RE(K) + DIRAC)6500             LET FFT2RE(N - K) = FFT2RE(K)6510             LET FFT2IM(K)     = SCALE*FFT2IM(K)6520             LET FFT2IM(N - K) = -FFT2IM(K)6530           NEXT K6540           LET HJWFLAG = 16550           LET ORG2$ = "L"6560           LET MMENU = 165706580         ELSE IF SETZERO = 1 THEN6590           MAT FFT2RE = 06600           MAT FFT2IM = 06610         END IF66206630         IF CBOT(-1) = CTOP(-1) THEN    !RESTORING THE TRANSFER FUNCTION6640           FOR K = 0 TO VAL6650             LET CTOP(K) = CTOP(K) + DIRAC*CBOT(K)6660           NEXT K6670         END IF66806690         PRINT6700         CALL TESTFFTDATA( N, FFTRE(), FFTIM(), FFT2RE(), FFT2IM(), TEMP2RE(), TEMP2IM(), FFTFLAG, FFT2FLAG, SYMMFLAG, HJWFLAG, KLEEN$ )6710         PRINT !TO RELEASE THE ";"6720       END IF6730     END IF6740   END IF6750 END SUB !LOADHJW6760 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!67706780 END SUB !Hjw6790 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!6800681068206830 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!6840 SUB CLEARFFT2( FFT2RE(), FFT2IM(), FFT2FLAG )68506860   MAT FFT2RE = 06870   MAT FFT2IM = 06880   LET FFT2FLAG = 068906900 END SUB !CLEARFFT26910 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!6920